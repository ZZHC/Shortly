<!DOCTYPE html>
<html>
    <head>
        <title>goo.gl OAuth</title>
        <script src="jsOAuth-mod.js"></script>
    </head>
    <body>
        <script>
          var options = {
              consumerKey: 'anonymous',
              consumerSecret: 'anonymous',
              callback: safari.extension.baseURI + 'oauth/finish.html'
          };
          
          var params = {
            'xoauth_displayname': 'Shortly Extension',
            'scope': 'https://www.googleapis.com/auth/urlshortener'
          };

          var oauth = OAuth(options);
          
          localStorage.removeItem('googl_oauth_token');
          localStorage.removeItem('googl_oauth_token_secret');
          
          oauth.post('https://www.google.com/accounts/OAuthGetRequestToken', params, function (data) {
              var token_secret = decodeURIComponent(data.text.match(/oauth_token_secret=([^\&]+)/)[1]);
              
              localStorage.setItem('googl_oauth_token_secret', token_secret);
              
              location.href = 'https://www.google.com/accounts/OAuthAuthorizeToken?oauth_token=' + data.text.match(/oauth_token=([^\&]+)/)[1];
          });
        </script>
    </body>
</html>

